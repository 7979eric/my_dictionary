<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…¼ë¬¸ ë¦¬ë”©ìš© ë‹¨ì–´ì¥</title>
    <style>
        :root {
            --primary-medical: #2c7be5;
            --bg-medical: #f0f7ff;
            --primary-general: #00d97e;
            --bg-general: #f2fff9;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 12px;
            --highlight-red: #e74c3c;
            --danger-color: #dc3545;
        }
        body {
            font-family: 'Pretendard', -apple-system, system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container { width: 100%; max-width: 800px; }
        h1 { text-align: center; color: #333; margin-bottom: 1.5rem; font-size: 1.6rem; }
        
        .data-controls { display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 10px; }
        .data-btn {
            background-color: #fff; border: 1px solid #ccc; padding: 6px 12px;
            border-radius: 6px; font-size: 0.8rem; cursor: pointer; color: #555;
            transition: all 0.2s;
        }
        .data-btn:hover { background-color: #f0f0f0; border-color: #999; }
        .data-btn.danger { color: var(--danger-color); border-color: #f5c6cb; }

        .tabs { display: flex; background: #e0e0e0; border-radius: var(--border-radius); padding: 4px; margin-bottom: 15px; }
        .tab-btn {
            flex: 1; padding: 12px; border: none; background: transparent;
            border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; color: #666;
        }
        .tab-btn.active[data-tab="medical"] { background: white; color: var(--primary-medical); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tab-btn.active[data-tab="general"] { background: white; color: var(--primary-general); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .input-card {
            background: var(--card-bg); padding: 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); margin-bottom: 2rem;
        }
        .mode-selector { display: flex; gap: 5px; margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .mode-btn {
            padding: 4px 10px; font-size: 0.75rem; border: 1px solid #ddd; background: #f9f9f9;
            border-radius: 4px; cursor: pointer; color: #777;
        }
        .mode-btn.active { background: #666; color: white; border-color: #666; }

        .input-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
        input, textarea, select {
            padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; font-family: inherit;
        }
        textarea { width: 100%; box-sizing: border-box; resize: vertical; min-height: 50px; }
        
        .bulk-guide { 
            font-size: 0.8rem; color: #555; margin-bottom: 8px; padding: 12px; 
            background: #fff9db; border-radius: 6px; border: 1px solid #fab005; 
            line-height: 1.6;
        }

        .btn-group { display: flex; gap: 8px; margin-top: 15px; }
        .primary-btn {
            flex: 2; background-color: var(--primary-medical); color: white; border: none;
            padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;
        }
        #cancel-btn { flex: 1; background-color: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; display: none; }

        .search-container { 
            display: flex; gap: 8px; margin-bottom: 20px; background: #fff; 
            padding: 8px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            align-items: center;
        }
        .search-select { width: 150px; flex-shrink: 0; border: 1px solid #ddd; cursor: pointer; background: #f8f9fa; height: 42px; }
        .search-wrapper { position: relative; flex: 1; display: flex; align-items: center; }
        .search-input { width: 100%; border: 1px solid #ddd; padding: 10px 35px 10px 10px; border-radius: 8px; height: 42px; box-sizing: border-box; }
        .search-clear { position: absolute; right: 10px; cursor: pointer; color: #ccc; font-size: 18px; display: none; user-select: none; }
        .search-clear:hover { color: #666; }

        .vocab-list { list-style: none; padding: 0; display: grid; gap: 12px; }
        .vocab-item { padding: 1.2rem; border-radius: var(--border-radius); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); position: relative; border: 1px solid transparent; }
        .vocab-item.item-medical { background-color: var(--bg-medical); border-color: #d0e4ff; }
        .vocab-item.item-medical .word { color: var(--primary-medical); }
        .vocab-item.item-general { background-color: var(--bg-general); border-color: #d6f5e8; }
        .vocab-item.item-general .word { color: #009e5c; }

        .cat-badge { display: inline-block; font-size: 0.65rem; padding: 2px 8px; border-radius: 10px; margin-bottom: 8px; font-weight: bold; color: white; }
        .item-medical .cat-badge { background: var(--primary-medical); }
        .item-general .cat-badge { background: var(--primary-general); }

        .word-group { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
        .word { font-size: 1.3rem; font-weight: 800; }
        .pronunciation { font-size: 0.95rem; color: #2c7be5; font-style: italic; margin-right: 5px; }
        .meaning { font-size: 1.05rem; color: #333; font-weight: 600; }
        
        .emphasis { color: var(--highlight-red); font-weight: 800; text-decoration: underline; }
        .deriv-text { font-size: 0.85rem; color: #666; margin-top: 4px; font-style: italic; }
        
        .example-box { background: rgba(255, 255, 255, 0.6); padding: 10px; border-radius: 6px; font-size: 0.9rem; margin-top: 8px; border-left: 3px solid #ddd; line-height: 1.5; color: #444; white-space: pre-wrap; word-break: break-all; }
        .supp-box { background: rgba(0, 0, 0, 0.04); padding: 10px; border-radius: 6px; font-size: 0.85rem; margin-top: 5px; border-left: 3px solid #6c757d; color: #555; white-space: pre-wrap; word-break: break-all; }
        
        .action-btns { position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; }
        .icon-btn { background: transparent; border: none; cursor: pointer; font-size: 0.95rem; color: #999; }
        .icon-btn:hover { color: #666; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“š ë…¼ë¬¸ ë¦¬ë”©ìš© ë‹¨ì–´ì¥ Pro</h1>
    
    <div class="data-controls">
        <button id="delete-all-btn" class="data-btn danger">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
        <button id="export-btn" class="data-btn">ğŸ“¤ ë°±ì—…</button>
        <button id="import-btn" class="data-btn">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="file-input" style="display: none;" accept=".json">
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-tab="medical" onclick="switchTab('medical')">ğŸ¥ ì˜í•™ ìš©ì–´</button>
        <button class="tab-btn" data-tab="general" onclick="switchTab('general')">ğŸ ì¼ë°˜ ì˜ë‹¨ì–´</button>
    </div>

    <div class="input-card">
        <div class="mode-selector">
            <button class="mode-btn active" id="mode-indiv" onclick="switchMode('individual')">ê°œë³„ ì…ë ¥</button>
            <button class="mode-btn" id="mode-bulk" onclick="switchMode('bulk')">ì¼ê´„ íŒŒì‹±</button>
        </div>

        <div id="individual-area">
            <div class="input-row">
                <select id="category-select" style="width: 110px;">
                    <option value="medical">ì˜í•™ ìš©ì–´</option>
                    <option value="general">ì¼ë°˜ ë‹¨ì–´</option>
                </select>
                <input type="text" id="word-input" placeholder="ë‹¨ì–´" style="flex:1">
                <input type="text" id="pronunciation-input" placeholder="ë°œìŒ" style="flex:1">
            </div>
            <div class="input-row">
                <input type="text" id="meaning-input" placeholder="ëœ»" style="flex:1">
                <input type="text" id="derivative-input" placeholder="íŒŒìƒì–´" style="flex:1">
            </div>
            <textarea id="example-input" placeholder="ì˜ˆì‹œ (ì¤„ë°”ê¿ˆ ë° ==ê°•ì¡°== ì ìš© ê°€ëŠ¥)"></textarea>
            <textarea id="supplement-input" placeholder="ë³´ì¶© ì„¤ëª… (ì˜í•™ ì „ìš©)"></textarea>
        </div>

        <div id="bulk-area" style="display:none;">
            <div id="bulk-guide-text" class="bulk-guide"></div>
            <textarea id="bulk-input" style="min-height:120px;" placeholder="ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        </div>

        <div class="btn-group">
            <button id="add-btn" class="primary-btn">ì¶”ê°€í•˜ê¸°</button>
            <button id="cancel-btn">ì·¨ì†Œ</button>
        </div>
    </div>

    <div class="search-container">
        <select id="search-target" class="search-select">
            <option value="all">ğŸ” ì „ì²´ ì°¾ê¸°</option>
            <option value="word">ë‹¨ì–´(íŒŒìƒì–´)</option>
            <option value="meaning">ëœ»</option>
            <option value="supp">ë³´ì¶© ì„¤ëª…</option>
        </select>
        <div class="search-wrapper">
            <input type="text" id="search-input" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            <span id="search-clear" class="search-clear" title="ê²€ìƒ‰ ì´ˆê¸°í™”">Ã—</span>
        </div>
    </div>

    <ul id="vocab-list" class="vocab-list"></ul>
</div>

<script>
    let vocabData = JSON.parse(localStorage.getItem('studyVocabData')) || [];
    let currentTab = 'medical';
    let currentMode = 'individual';
    let editingId = null;

    const wordInput = document.getElementById('word-input'),
          pronunciationInput = document.getElementById('pronunciation-input'),
          meaningInput = document.getElementById('meaning-input'),
          derivativeInput = document.getElementById('derivative-input'),
          exampleInput = document.getElementById('example-input'),
          supplementInput = document.getElementById('supplement-input'),
          bulkInput = document.getElementById('bulk-input'),
          bulkGuideText = document.getElementById('bulk-guide-text'),
          categorySelect = document.getElementById('category-select'),
          addBtn = document.getElementById('add-btn'),
          cancelBtn = document.getElementById('cancel-btn'),
          vocabList = document.getElementById('vocab-list'),
          searchInput = document.getElementById('search-input'),
          searchClear = document.getElementById('search-clear'),
          searchTarget = document.getElementById('search-target'),
          exportBtn = document.getElementById('export-btn'),
          importBtn = document.getElementById('import-btn'),
          deleteAllBtn = document.getElementById('delete-all-btn'),
          fileInput = document.getElementById('file-input');

    function checkDuplicate(word, category) {
        return vocabData.some(existing => 
            existing.word.trim().toLowerCase() === word.trim().toLowerCase() && 
            existing.category === category
        );
    }

    function saveAndRender() { 
        localStorage.setItem('studyVocabData', JSON.stringify(vocabData)); 
        renderList(); 
    }

    deleteAllBtn.addEventListener('click', () => {
        if (vocabData.length === 0) { alert("ì‚­ì œí•  ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
        if (confirm("ëª¨ë“  ë‹¨ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            if (confirm("ë§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.")) {
                vocabData = []; saveAndRender(); alert("ëª¨ë“  ë‹¨ì–´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }
    });

    exportBtn.addEventListener('click', () => {
        if (vocabData.length === 0) { alert("ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
        const dataStr = JSON.stringify(vocabData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const now = new Date();
        const timestamp = now.getFullYear() + String(now.getMonth() + 1).padStart(2, '0') + String(now.getDate()).padStart(2, '0') + '_' + String(now.getHours()).padStart(2, '0') + String(now.getMinutes()).padStart(2, '0') + String(now.getSeconds()).padStart(2, '0');
        const a = document.createElement('a'); a.href = url; a.download = `vocab_backup_${timestamp}.json`; a.click(); URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const importedData = JSON.parse(event.target.result);
                if (!Array.isArray(importedData)) throw new Error("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                let addedCount = 0; let skipCount = 0;
                importedData.forEach(newItem => {
                    if (checkDuplicate(newItem.word, newItem.category)) { skipCount++; }
                    else { if(!newItem.id) newItem.id = Date.now() + Math.random(); vocabData.push(newItem); addedCount++; }
                });
                saveAndRender();
                alert(`${addedCount}ê°œì˜ ë‹¨ì–´ ì¶”ê°€ë¨ / ${skipCount}ê°œ ì¤‘ë³µ ê±´ë„ˆëœ€\ní˜„ì¬ ì´ ë‹¨ì–´ ìˆ˜: ${vocabData.length}ê°œ`);
            } catch (err) { alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + err.message); }
            fileInput.value = '';
        }; reader.readAsText(file);
    });

    function switchTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabName));
        categorySelect.value = tabName; updateUI(); renderList();
    }

    function switchMode(mode) {
        currentMode = mode;
        document.getElementById('mode-indiv').classList.toggle('active', mode === 'individual');
        document.getElementById('mode-bulk').classList.toggle('active', mode === 'bulk');
        document.getElementById('individual-area').style.display = (mode === 'individual') ? 'block' : 'none';
        document.getElementById('bulk-area').style.display = (mode === 'bulk') ? 'block' : 'none';
        if (mode === 'bulk') {
            const format = currentTab === 'medical' ? "ë‹¨ì–´ @@ ëœ» @@ ë°œìŒ @@ íŒŒìƒì–´ @@ ì˜ˆì‹œ @@ ë³´ì¶©ì„¤ëª…" : "ë‹¨ì–´ @@ ëœ» @@ ë°œìŒ @@ íŒŒìƒì–´ @@ ì˜ˆì‹œ";
            bulkGuideText.innerHTML = `í˜„ì¬ ì„¹ì…˜: <b>${currentTab === 'medical' ? 'ğŸ¥ ì˜í•™ ìš©ì–´' : 'ğŸ ì¼ë°˜ ë‹¨ì–´'}</b><br>í˜•ì‹: <b>${format}</b><br><small>(í•­ëª© ê°„ <b>@@</b> êµ¬ë¶„, ê°•ì¡°ëŠ” <b>==ë‹¨ì–´==</b> ê¸°í˜¸ ì‚¬ìš©)</small>`;
            bulkInput.placeholder = `ì˜ˆì‹œ: EEG @@ ë‡Œì „ì¦ @@ /ËŒiË.iË.ËˆdÊ’iË/ @@ n. electroencephalogram @@ ==EEG== signals are filtered. @@ ë‡Œì˜ ì „ê¸°ì  í™œë™ ì¸¡ì • ë„êµ¬`;
            addBtn.innerText = 'ì¼ê´„ íŒŒì‹± ë° ì¶”ê°€';
        } else { addBtn.innerText = editingId ? 'ìˆ˜ì • ì™„ë£Œ' : 'ì¶”ê°€í•˜ê¸°'; }
    }

    function updateUI() {
        const isMedical = categorySelect.value === 'medical';
        supplementInput.style.display = isMedical ? 'block' : 'none';
        addBtn.style.backgroundColor = isMedical ? 'var(--primary-medical)' : 'var(--primary-general)';
        if (currentMode === 'bulk') switchMode('bulk');
    }

    addBtn.addEventListener('click', () => {
        if (currentMode === 'bulk') {
            const lines = bulkInput.value.split('\n').filter(l => l.trim());
            let added = 0; let skipped = 0;
            lines.forEach(line => {
                const p = line.split('@@').map(x => x.trim());
                if (p[0] && p[1]) {
                    if (checkDuplicate(p[0], currentTab)) { skipped++; }
                    else {
                        vocabData.unshift({ 
                            id: Date.now() + Math.random(), 
                            word: p[0], meaning: p[1], 
                            pronunciation: p[2] || '', derivative: p[3] || '', example: p[4] || '', 
                            supplement: (currentTab === 'medical' ? (p[5] || '') : ''), 
                            category: currentTab 
                        });
                        added++;
                    }
                }
            });
            bulkInput.value = '';
            alert(`${added}ê°œì˜ ë‹¨ì–´ ì¶”ê°€ ì™„ë£Œ, ${skipped}ê°œì˜ ì¤‘ë³µ ë‹¨ì–´ ê±´ë„ˆëœ€.`);
        } else {
            const word = wordInput.value.trim(), 
                  meaning = meaningInput.value.trim(),
                  pronunciation = pronunciationInput.value.trim();
            if (!word || !meaning) return;
            if (!editingId && checkDuplicate(word, categorySelect.value)) { alert("ì´ë¯¸ ë™ì¼í•œ ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ë‹¨ì–´ì…ë‹ˆë‹¤."); return; }
            const item = { word, meaning, pronunciation, derivative: derivativeInput.value.trim(), example: exampleInput.value.trim(), supplement: categorySelect.value === 'medical' ? supplementInput.value.trim() : '', category: categorySelect.value };
            if (editingId) { vocabData = vocabData.map(i => i.id === editingId ? { ...i, ...item } : i); editingId = null; cancelBtn.style.display = 'none'; }
            else { vocabData.unshift({ id: Date.now(), ...item }); }
            clearInputs();
        }
        saveAndRender();
    });

    function applyStyle(text) {
        if (!text) return '';
        let safe = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        return safe.replace(/\=\=([^\=]+)\=\=/g, '<span class="emphasis">$1</span>');
    }

    function renderList() {
        vocabList.innerHTML = '';
        const term = searchInput.value.toLowerCase();
        const target = searchTarget.value;
        const isSearching = term.length > 0;
        searchClear.style.display = isSearching ? 'block' : 'none';
        const filtered = vocabData.filter(i => {
            if (!isSearching && i.category !== currentTab) return false;
            if (!isSearching) return true;
            const inWord = (i.word + (i.derivative || "")).toLowerCase().includes(term);
            const inMeaning = i.meaning.toLowerCase().includes(term);
            const inSupp = (i.supplement || "").toLowerCase().includes(term);
            if (target === 'word') return inWord; if (target === 'meaning') return inMeaning; if (target === 'supp') return inSupp;
            return inWord || inMeaning || inSupp || (i.example || "").toLowerCase().includes(term);
        });
        filtered.forEach(item => {
            const li = document.createElement('li'); li.className = `vocab-item item-${item.category}`;
            li.innerHTML = `
                ${isSearching ? `<span class="cat-badge">${item.category === 'medical' ? 'ì˜í•™' : 'ì¼ë°˜'}</span>` : ''}
                <div class="word-group">
                    <span class="word">${item.word}</span>
                    ${item.pronunciation ? `<span class="pronunciation">[${item.pronunciation}]</span>` : ''}
                    <span class="meaning">${item.meaning}</span>
                </div>
                <div class="action-btns">
                    <button class="icon-btn" title="ìˆ˜ì •" onclick="startEdit(${item.id})">âœï¸</button>
                    <button class="icon-btn" title="ì‚­ì œ" onclick="deleteWord(${item.id})">ğŸ—‘ï¸</button>
                </div>
                ${item.derivative ? `<div class="deriv-text">íŒŒìƒ: ${item.derivative}</div>` : ''}
                ${item.example ? `<div class="example-box">${applyStyle(item.example)}</div>` : ''}
                ${item.supplement ? `<div class="supp-box">ğŸ’¡ ${applyStyle(item.supplement)}</div>` : ''}
            `;
            vocabList.appendChild(li);
        });
    }

    searchClear.addEventListener('click', () => { searchInput.value = ''; renderList(); searchInput.focus(); });
    function clearInputs() { [wordInput, pronunciationInput, meaningInput, derivativeInput, exampleInput, supplementInput].forEach(el => el.value = ''); }
    window.startEdit = function(id) {
        const item = vocabData.find(i => i.id === id); editingId = id; switchMode('individual');
        wordInput.value = item.word; 
        pronunciationInput.value = item.pronunciation || '';
        meaningInput.value = item.meaning; 
        derivativeInput.value = item.derivative || ''; 
        exampleInput.value = item.example || ''; 
        supplementInput.value = item.supplement || ''; 
        categorySelect.value = item.category; 
        updateUI();
        cancelBtn.style.display = 'block'; window.scrollTo(0, 0);
    };
    window.deleteWord = function(id) { if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { vocabData = vocabData.filter(i => i.id !== id); saveAndRender(); } };
    searchInput.addEventListener('input', renderList); searchTarget.addEventListener('change', renderList); categorySelect.addEventListener('change', updateUI); updateUI(); renderList();
</script>
</body>
</html>
